实现类似于**收银机、自助终端、广告机**那种“开机即锁定、用户退不出来”的效果，那么标准的广播启动是不够的。你需要使用 Android 的 **Lock Task Mode（Kiosk 模式）**。

这种模式有两种实现深度：**普通模式（Pinning）和完全锁定模式（Owner Mode）**。

### 1. 方案选择：你是哪种情况？

| **方案**                   | **限制强度**                   | **实现难度**          | **适用场景**               |
| -------------------------- | ------------------------------ | --------------------- | -------------------------- |
| **应用固定 (App Pinning)** | 中：用户可以手动解除（组合键） | 低：只需几行代码      | 演示、临时给别人用手机     |
| **设备所有者模式 (Kiosk)** | **高：彻底锁定，无法退出**     | 中：需要通过 ADB 激活 | 自助机、工控设备、企业平板 |

### 2. 完全锁定模式实现步骤 (Kotlin)

要实现彻底锁定，你需要让你的 App 成为设备的“管理员”（Device Owner）。

#### 第一步：在 Manifest 中注册设备管理员

在 `res/xml` 下新建 `device_admin.xml`:

```xml
<device-admin xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-policies>
        <limit-password />
    </uses-policies>
</device-admin>
```

然后在 `AndroidManifest.xml` 中注册：

```xml
<receiver
    android:name=".MyDeviceAdminReceiver"
    android:permission="android.permission.BIND_DEVICE_ADMIN">
    <meta-data android:name="android.app.device_admin"
               android:resource="@xml/device_admin" />
    <intent-filter>
        <action android:name="android.app.action.DEVICE_ADMIN_ENABLED" />
    </intent-filter>
</receiver>
```

#### 第二步：编写 Activity 锁定代码

在你的 `MainActivity` 中，使用 `DevicePolicyManager` 锁定屏幕：

```kotlin
val dpm = getSystemService(Context.DEVICE_POLICY_SERVICE) as DevicePolicyManager
val adminName = ComponentName(this, MyDeviceAdminReceiver::class.java)

if (dpm.isDeviceOwnerApp(packageName)) {
    // 允许哪些包名可以被锁定（必须包含自己）
    dpm.setLockTaskPackages(adminName, arrayOf(packageName))
    // 启动锁定模式
    startLockTask()
} else {
    // 如果不是 Device Owner，只能实现普通固定（会有退出提示）
    startLockTask()
}
```

#### 第三步：关键步骤——通过 ADB 激活管理员权限

**这是最关键的一步**，因为普通应用无法在手机上直接通过代码变成 Device Owner。

1. 在手机设置中**移除所有 Google 账号/小米账号等**（激活后再登录）。

2. 连接电脑，打开终端执行：记住包名后面加斜杠/而不是点。然后选择.MyDeviceAdminReceiver

   ```bash
   adb shell dpm set-device-owner com.your.package.name/.MyDeviceAdminReceiver
   ```

 3. 让 App 变成“桌面” (Launcher)

为了让设备一开机就**直接显示你的 App**（甚至跳过原生的桌面），你应该把应用设置为 Launcher。

在 `AndroidManifest.xml` 的启动 Activity 过滤器中添加

```xml
<intent-filter>
    <action android:name="android.intent.action.MAIN" />
    <category android:name="android.intent.category.LAUNCHER" />
    
    <category android:name="android.intent.category.HOME" />
    <category android:name="android.intent.category.DEFAULT" />
</intent-filter>
```



**效果：** 安装后，按下 Home 键系统会提示你选择“默认桌面”，勾选你的应用并选择“始终”。这样开机后系统会直接加载你的 Activity。

### 代码实现

1. 创建管理员接收器 `MyDeviceAdminReceiver.kt`

   ```kotlin
   import android.app.admin.DeviceAdminReceiver
   import android.content.Context
   import android.content.Intent
   import android.widget.Toast
   
   class MyDeviceAdminReceiver : DeviceAdminReceiver() {
       override fun onEnabled(context: Context, intent: Intent) {
           super.onEnabled(context, intent)
           Toast.makeText(context, "设备管理员权限已启用", Toast.LENGTH_SHORT).show()
       }
   
       override fun onDisabled(context: Context, intent: Intent) {
           super.onDisabled(context, intent)
           Toast.makeText(context, "设备管理员权限已禁用", Toast.LENGTH_SHORT).show()
       }
   }
   ```

   

2. 在 `MainActivity.kt` 中实现锁定逻辑

   建议在 `onResume` 或点击某个按钮时触发锁定。

   ```kotlin
   import android.app.admin.DevicePolicyManager
   import android.content.ComponentName
   import android.content.Context
   import android.os.Bundle
   import androidx.appcompat.app.AppCompatActivity
   
   class MainActivity : AppCompatActivity() {
   
       private lateinit var dpm: DevicePolicyManager
       private lateinit var adminName: ComponentName
   
       override fun onCreate(savedInstanceState: Bundle?) {
           super.onCreate(savedInstanceState)
           setContentView(R.layout.activity_main)
   
           // 初始化设备策略管理器
           dpm = getSystemService(Context.DEVICE_POLICY_SERVICE) as DevicePolicyManager
           adminName = ComponentName(this, MyDeviceAdminReceiver::class.java)
   
           // 尝试开启 Kiosk 模式
           setupKioskMode()
       }
   
       private fun setupKioskMode() {
           // 检查应用是否已经是 Device Owner (通过 ADB 激活)
           if (dpm.isDeviceOwnerApp(packageName)) {
               // 允许当前应用进入锁定模式
               dpm.setLockTaskPackages(adminName, arrayOf(packageName))
               
               // 启动锁定 (如果已经设置了包名，此方法会直接锁定且没有确认弹窗)
               startLockTask()
               
               // 可选：禁用状态栏、通知栏、电源键菜单等（仅限 Android 9.0+）
               dpm.setLockTaskFeatures(adminName, 
                   DevicePolicyManager.LOCK_TASK_FEATURE_NONE // 彻底禁用一切
               )
           } else {
               // 如果不是 Device Owner，则调用普通 Pinning (用户可以手动退出)
               startLockTask()
           }
       }
       
       // 如果需要主动退出锁定模式，可以调用 stopLockTask()
   }
   ```

   

###  如何“解救”手机？

   一旦开启了 `Device Owner`，普通的卸载方式可能失效。如果你需要恢复手机：

   - **代码解禁**：在 App 里写一个隐藏按钮调用 `dpm.clearDeviceOwnerApp(packageName)`（注意：这在 Android 7.0+ 之后有限制）。

   - **ADB 强行卸载**：

     Bash

     ```
     adb shell dumpsys device_policy # 查看所有者信息
     adb shell dpm remove-active-admin com.你的包名/.MyDeviceAdminReceiver
     adb uninstall com.你的包名
     ```

### 进阶：禁用状态栏和导航栏 (Kotlin)

```kotlin
private fun setCustomLockTaskFeatures() {
    if (dpm.isDeviceOwnerApp(packageName)) {
        // 允许以下功能：
        // LOCK_TASK_FEATURE_NONE 代表禁用一切（包括下拉栏、通知、Home键等）
        val flags = DevicePolicyManager.LOCK_TASK_FEATURE_NONE
        
        dpm.setLockTaskFeatures(adminName, flags)
    }
}
```

1. 自动亮度与屏幕常亮

   ```kotlin
   // 保持屏幕常亮
   window.addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON)
   ```

   